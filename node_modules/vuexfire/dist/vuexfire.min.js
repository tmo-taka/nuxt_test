/*!
  * vuexfire v3.2.0-alpha.0
  * (c) 2019 Eduardo San Martin Morote
  * @license MIT
  */
var Vuexfire=function(e){"use strict";var t="vuexfire/SET_VALUE",n="vuexfire/ARRAY_ADD",r="vuexfire/ARRAY_REMOVE";function o(e){return e&&"object"==typeof e}function i(e,t){for(var n=0;n<e.length;n++)if(e[n][".key"]===t)return n;return-1}var a={reset:!0,serialize:function(e){var t=e.val(),n=o(t)?t:Object.defineProperty({},".value",{value:t});return Object.defineProperty(n,".key",{value:e.key}),n},wait:!1};function u(e,t,n,r){void 0===t&&(t={}),void 0===n&&(n=""),void 0===r&&(r=[{},{}]),t=t||{};var i=r[0],a=r[1],c=Object.getOwnPropertyDescriptor(e,"id");c&&!c.enumerable&&Object.defineProperty(i,"id",c);var s=function(r){var c,s=e[r];if((c=s)&&c.onSnapshot)i[r]=t[r]||s.path,a[n+r]=s;else if(Array.isArray(s)){i[r]=Array(s.length);var f=(t[r]||[]).filter(function(e){return-1!==s.indexOf(e)});u(s,f,n+r+".",[i[r],a])}else null==s||s instanceof Date||function(e){return e.toDate}(s)||s.longitude&&s.latitude?i[r]=s:o(s)?(i[r]={},u(s,t[r],n+r+".",[i[r],a])):i[r]=s};for(var f in e)s(f);return r}var c,s={maxRefDepth:2,reset:!0,serialize:function(e){return Object.defineProperty(e.data(),"id",{value:e.id})},wait:!1};function f(e){for(var t in e)e[t].unsub()}function l(e,t){var n=e.snapshot,r=e.target,o=e.path,i=e.subs,a=e.ops,c=e.depth,s=e.resolve,f=u(n,function(e,t){return t.split(".").reduce(function(e,t){return e[t]},e)}(r,o)),l=f[0],d=f[1];a.set(r,o,l),v({subs:i,refs:d,target:r,path:o,ops:a,depth:c,resolve:s},t)}function d(e,t){var n=e.ref,r=e.target,o=e.path,i=e.depth,a=e.resolve,u=e.ops,c=Object.create(null),s=n.onSnapshot(function(e){e.exists?l({snapshot:t.serialize(e),target:r,path:o,ops:u,subs:c,depth:i,resolve:a},t):(u.set(r,o,null),a(o))});return function(){s(),f(c)}}function v(e,t){var n=e.subs,r=e.refs,o=e.target,i=e.path,a=e.depth,u=e.ops,c=e.resolve,s=Object.keys(r);if(Object.keys(n).filter(function(e){return s.indexOf(e)<0}).forEach(function(e){n[e].unsub(),delete n[e]}),!s.length||++a>t.maxRefDepth)return c(i);var f=0,l=s.length,v=Object.create(null);function p(e){e in v&&++f>=l&&c(i)}s.forEach(function(e){var c=n[e],s=r[e],f=i+"."+e;if(v[f]=!0,c){if(c.path===s.path)return;c.unsub()}n[e]={unsub:d({ref:s,target:o,path:f,depth:a,ops:u,resolve:p.bind(null,f)},t),path:s.path}})}var p=((c={})[t]=function(e,t){var n=t.path;!function(e,t,n){var r=(""+t).split("."),o=r.pop(),i=r.reduce(function(e,t){return e[t]},e);Array.isArray(i)?i.splice(Number(o),1,n):i[o]=n}(t.target,n,t.data)},c[n]=function(e,t){var n=t.newIndex,r=t.data;t.target.splice(n,0,r)},c[r]=function(e,t){var n=t.oldIndex;return t.target.splice(n,1)[0]},c),h=function(){return(h=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},b={root:!0},g=new WeakMap;function y(e,t,n,r,o,u){var c=g.get(t);return c||(c=Object.create(null),g.set(t,c)),n in c&&m(t,n,u&&u.reset),new Promise(function(t,s){c[n]=Array.isArray(e[n])?function(e,t){var n=e.vm,r=e.key,o=e.collection,u=e.resolve,c=e.reject,s=e.ops;void 0===t&&(t=a);var f=Object.assign({},a,t),l=f.wait?[]:s.set(n,r,[]),d=o.on("child_added",function(e,t){var n=t?i(l,t)+1:0;s.add(l,n,f.serialize(e))},c),v=o.on("child_removed",function(e){s.remove(l,i(l,e.key))},c),p=o.on("child_changed",function(e){s.set(l,i(l,e.key),f.serialize(e))},c),h=o.on("child_moved",function(e,t){var n=i(l,e.key),r=s.remove(l,n)[0],o=t?i(l,t)+1:0;s.add(l,o,r)},c);return o.once("value",function(e){f.wait&&s.set(n,r,l),u(e)}),function(e){if(o.off("child_added",d),o.off("child_changed",p),o.off("child_removed",v),o.off("child_moved",h),!1!==e){var t="function"==typeof e?e():[];s.set(n,r,t)}}}({vm:e,key:n,collection:r,ops:o,resolve:t,reject:s},u):function(e,t){var n=e.vm,r=e.key,o=e.document,i=e.resolve,u=e.reject,c=e.ops;void 0===t&&(t=a);var s=Object.assign({},a,t),f=o.on("value",function(e){c.set(n,r,s.serialize(e))},u);return o.once("value",i),function(e){if(o.off("value",f),!1!==e){var t="function"==typeof e?e():null;c.set(n,r,t)}}}({vm:e,key:n,document:r,ops:o,resolve:t,reject:s},u)})}function m(e,t,n){var r=g.get(e);r&&r[t]&&(r[t](n),delete r[t])}var j={root:!0},O=new WeakMap;function x(e,t,n,r,o,i){var a=O.get(t);return a||(a=Object.create(null),O.set(t,a)),n in a&&w(t,n,i.wait?"function"==typeof i.reset&&i.reset:i.reset),new Promise(function(t,c){a[n]="where"in r?function(e,t){var n=e.vm,r=e.key,o=e.collection,i=e.ops,a=e.resolve,c=e.reject;void 0===t&&(t=s);var l,d=Object.assign({},s,t),p=d.wait?[]:i.set(n,r,[]),h=a,b=[],g={added:function(e){var t=e.newIndex,n=e.doc;b.splice(t,0,Object.create(null));var r=b[t],o=u(d.serialize(n)),c=o[0],s=o[1];i.add(p,t,c),v({refs:s,subs:r,target:p,path:t,depth:0,ops:i,resolve:a.bind(null,n)},d)},modified:function(e){var t=e.oldIndex,n=e.newIndex,r=e.doc,o=b.splice(t,1)[0];b.splice(n,0,o);var c=i.remove(p,t)[0],s=u(d.serialize(r),c),f=s[0],l=s[1];i.add(p,n,f),v({refs:l,subs:o,ops:i,target:p,path:n,depth:0,resolve:a},d)},removed:function(e){var t=e.oldIndex;i.remove(p,t),f(b.splice(t,1)[0])}},y=o.onSnapshot(function(e){var t="function"==typeof e.docChanges?e.docChanges():e.docChanges;if(!l&&t.length){l=!0;for(var o=0,u=t.length,c=Object.create(null),s=0;s<u;s++)c[t[s].doc.id]=!0;a=function(e){e.id in c&&++o>=u&&(d.wait&&i.set(n,r,p),h(n[r]),a=function(){})}}t.forEach(function(e){g[e.type](e)}),t.length||(d.wait&&i.set(n,r,p),a())},c);return function(e){if(y(),!1!==e){var t="function"==typeof e?e():[];i.set(n,r,t)}b.forEach(f)}}({vm:e,key:n,collection:r,ops:o,resolve:t,reject:c},i):function(e,t){var n=e.vm,r=e.key,o=e.document,i=e.resolve,a=e.reject,u=e.ops;void 0===t&&(t=s);var c,d,v,p=Object.assign({},s,t),h=Object.create(null);c=i,d=function(){return n[r]},v=!1,i=function(){if(!v)return v=!0,c(d())};var b=o.onSnapshot(function(e){e.exists?l({snapshot:p.serialize(e),target:n,path:r,subs:h,ops:u,depth:0,resolve:i},p):i()},a);return function(e){if(b(),!1!==e){var t="function"==typeof e?e():null;u.set(n,r,t)}f(h)}}({vm:e,key:n,document:r,ops:o,resolve:t,reject:c},i)})}function w(e,t,n){var r=O.get(e);r&&r[t]&&(r[t](n),delete r[t])}return e.firebaseAction=function(e){return function(o,i){var u=o.state,c=o.commit,s={set:function(e,n,r){return c(t,{path:n,target:e,data:r},b),r},add:function(e,t,r){return c(n,{target:e,newIndex:t,data:r},b)},remove:function(e,t){var n=e[t];return c(r,{target:e,oldIndex:t},b),[n]}};return e.call(this,h({},o,{bindFirebaseRef:function(e,t,n){return y(u,c,e,t,s,Object.assign({},a,n))},unbindFirebaseRef:function(e,t){return m(c,e,t)}}),i)}},e.firestoreAction=function(e){return function(o,i){var a=o.state,u=o.commit,c={set:function(e,n,r){return u(t,{path:n,target:e,data:r},j),r},add:function(e,t,r){return u(n,{target:e,newIndex:t,data:r},j)},remove:function(e,t){var n=e[t];return u(r,{target:e,oldIndex:t},j),[n]}};return e.call(this,h({},o,{bindFirestoreRef:function(e,t,n){return x(a,u,e,t,c,Object.assign({},s,n))},unbindFirestoreRef:function(e,t){return w(u,e,t)}}),i)}},e.firestoreOptions=s,e.rtdbOptions=a,e.vuexfireMutations=p,e}({});
